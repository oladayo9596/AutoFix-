@using System.Security.Claims
@using AutoFix.Models
@{
    ViewData["Title"] = "Profile Dashboard";
    var userId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
    var userName = User.FindFirst(ClaimTypes.Name)?.Value;
    var email = User.FindFirst(ClaimTypes.Email)?.Value;
    var fullName = User.FindFirst("FullName")?.Value;
    var role = User.FindFirst(ClaimTypes.Role)?.Value;
    var isMechanic = role == "Mechanic";
    var joinDate = DateTime.Now.AddMonths(-2).ToString("MMM yyyy"); // Placeholder, ideally from user model
}

<div class="container-fluid mt-4 px-4">
    <!-- Success Alert -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Profile Header Banner -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-primary text-white shadow-sm rounded-3 overflow-hidden">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center">
                        <div class="avatar-profile bg-white rounded-circle d-flex align-items-center justify-content-center me-4" style="width: 100px; height: 100px;">
                            <i class="bi bi-person-circle text-primary" style="font-size: 4rem;"></i>
                        </div>
                        <div>
                            <h2 class="mb-1">@fullName</h2>
                            <p class="mb-0 opacity-75">@email</p>
                            <div class="d-flex align-items-center mt-2">
                                <span class="badge bg-white text-primary me-2">@role</span>
                                <span class="small">â€¢ Member since @joinDate</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Profile Info Card -->
        <div class="col-md-4">
            <div class="card shadow-sm mb-4 rounded-3 border-0">
                <div class="card-header bg-white border-bottom-0">
                    <div class="d-flex align-items-center justify-content-between">                        <h5 class="text-primary mb-0"><i class="bi bi-person-badge me-2"></i>Profile Information</h5>
                        <a href="#" class="text-dark" data-bs-toggle="modal" data-bs-target="#editProfileModal" title="Edit Profile"><i class="bi bi-pencil-square"></i></a>
                    </div>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between px-0">
                            <span class="text-muted">Username</span>
                            <span class="fw-medium">@userName</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between px-0">
                            <span class="text-muted">Email Address</span>
                            <span class="fw-medium">@email</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between px-0">
                            <span class="text-muted">Account Type</span>
                            <span class="fw-medium">@role</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between px-0">
                            <span class="text-muted">Profile Status</span>
                            <span class="badge bg-success rounded-pill">Active</span>
                        </li>
                    </ul>
                      <div class="d-grid gap-2 mt-3">
                        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editProfileModal">
                            <i class="bi bi-pencil me-1"></i> Edit Profile
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Additional User Stats -->
            <div class="card shadow-sm mb-4 rounded-3 border-0">
                <div class="card-header bg-white border-bottom-0">
                    <h5 class="text-primary mb-0"><i class="bi bi-graph-up me-2"></i>User Stats</h5>
                </div>
                <div class="card-body">                    <div class="row text-center">
                        <div class="col-4">
                            <h3 class="fw-bold text-primary">@(isMechanic ? ViewBag.CompletedOrdersCount ?? 0 : ViewBag.OrdersCount ?? 0)</h3>
                            <p class="text-muted small mb-0">@(isMechanic ? "Completed" : "Total")</p>
                        </div>
                        <div class="col-4">
                            <h3 class="fw-bold text-warning">@(isMechanic ? "0" : "0")</h3>
                            <p class="text-muted small mb-0">@(isMechanic ? "In Progress" : "Active")</p>
                        </div>
                        <div class="col-4">
                            <h3 class="fw-bold text-success">@(isMechanic ? "98%" : "4.8")</h3>
                            <p class="text-muted small mb-0">@(isMechanic ? "Rating" : "Rating")</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="col-md-8">
            <!-- Activity Card -->
            <div class="card shadow-sm mb-4 rounded-3 border-0">
                <div class="card-header bg-white border-bottom-0">
                    <div class="d-flex align-items-center justify-content-between">
                        <h5 class="text-primary mb-0">
                            <i class="bi bi-@(isMechanic ? "tools" : "activity") me-2"></i>
                            @(isMechanic ? "Services & Expertise" : "Recent Activity")
                        </h5>
                        <div>
                            <a class="btn btn-sm btn-outline-primary rounded-pill">
                                <i class="bi bi-@(isMechanic ? "briefcase" : "plus-circle") me-1"></i>
                                @(isMechanic ? "Service History" : "New Request")
                            </a>
                        </div>
                    </div>
                </div>                <div class="card-body">
                    @if (isMechanic)
                    {
                        <!-- Mechanic Service Tabs -->
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="skills-tab" data-bs-toggle="tab" data-bs-target="#skills" type="button" role="tab" aria-controls="skills" aria-selected="true">
                                    <i class="bi bi-wrench me-1"></i>Skills
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="services-tab" data-bs-toggle="tab" data-bs-target="#services" type="button" role="tab" aria-controls="services" aria-selected="false">
                                    <i class="bi bi-gear me-1"></i>Services
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab" aria-controls="reviews" aria-selected="false">
                                    <i class="bi bi-star me-1"></i>Reviews
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content py-3" id="myTabContent">
                            <!-- Skills Tab -->
                            <div class="tab-pane fade show active" id="skills" role="tabpanel" aria-labelledby="skills-tab">
                                <div class="mb-3">
                                    <div class="d-flex flex-wrap gap-2">
                                        <span class="badge rounded-pill bg-primary py-2 px-3">
                                            <i class="bi bi-gear-fill me-1"></i>Engine Repair
                                        </span>
                                        <span class="badge rounded-pill bg-primary py-2 px-3">
                                            <i class="bi bi-gear-fill me-1"></i>Transmission
                                        </span>
                                        <span class="badge rounded-pill bg-primary py-2 px-3">
                                            <i class="bi bi-tools me-1"></i>Brakes
                                        </span>
                                        <span class="badge rounded-pill bg-primary py-2 px-3">
                                            <i class="bi bi-lightning me-1"></i>Electrical Systems
                                        </span>
                                        <span class="badge rounded-pill bg-primary py-2 px-3">
                                            <i class="bi bi-gear-wide-connected me-1"></i>Suspension
                                        </span>
                                        <span class="badge rounded-pill bg-primary py-2 px-3">
                                            <i class="bi bi-snow2 me-1"></i>A/C Repair
                                        </span>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <h6 class="text-muted mb-3">Skill Proficiency</h6>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span>Engine Repair</span>
                                            <span>95%</span>
                                        </div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 95%" aria-valuenow="95" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span>Transmission</span>
                                            <span>85%</span>
                                        </div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 85%" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span>Electrical Systems</span>
                                            <span>90%</span>
                                        </div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 90%" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Services Tab -->
                            <div class="tab-pane fade" id="services" role="tabpanel" aria-labelledby="services-tab">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="card border">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <span class="rounded-circle bg-primary p-2 text-white me-3">
                                                        <i class="bi bi-droplet-fill"></i>
                                                    </span>
                                                    <div>
                                                        <h6 class="mb-1">Oil Change</h6>
                                                        <p class="small text-muted mb-0">From $29.99</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card border">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <span class="rounded-circle bg-warning p-2 text-white me-3">
                                                        <i class="bi bi-tools"></i>
                                                    </span>
                                                    <div>
                                                        <h6 class="mb-1">Brake Service</h6>
                                                        <p class="small text-muted mb-0">From $89.99</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card border">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <span class="rounded-circle bg-success p-2 text-white me-3">
                                                        <i class="bi bi-battery-charging"></i>
                                                    </span>
                                                    <div>
                                                        <h6 class="mb-1">Battery Replacement</h6>
                                                        <p class="small text-muted mb-0">From $75.99</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card border">
                                            <div class="card-body">
                                                <div class="d-flex align-items-center">
                                                    <span class="rounded-circle bg-info p-2 text-white me-3">
                                                        <i class="bi bi-grid-3x3-gap-fill"></i>
                                                    </span>
                                                    <div>
                                                        <h6 class="mb-1">Tire Rotation</h6>
                                                        <p class="small text-muted mb-0">From $49.99</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Reviews Tab -->
                            <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                                <div class="text-center mb-4">
                                    <div class="display-4 fw-bold text-warning">4.8</div>
                                    <div>
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <i class="bi bi-star-half text-warning"></i>
                                    </div>
                                    <p class="text-muted mt-1">Based on 48 reviews</p>
                                </div>
                                <div class="border-top pt-3">
                                    <div class="d-flex mb-3">
                                        <div class="flex-shrink-0">
                                            <div class="avatar bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                                <i class="bi bi-person text-primary"></i>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <h6 class="mb-0">John Smith</h6>
                                                <div class="text-warning small">
                                                    <i class="bi bi-star-fill"></i>
                                                    <i class="bi bi-star-fill"></i>
                                                    <i class="bi bi-star-fill"></i>
                                                    <i class="bi bi-star-fill"></i>
                                                    <i class="bi bi-star-fill"></i>
                                                </div>
                                            </div>
                                            <p class="text-muted small mb-0">2 weeks ago</p>
                                            <p class="mt-2">Excellent service! Fixed my car quickly and for a fair price.</p>
                                        </div>
                                    </div>
                                    <div class="border-top pt-3 mt-3">
                                        <div class="d-flex">
                                            <div class="flex-shrink-0">
                                                <div class="avatar bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                                    <i class="bi bi-person text-primary"></i>
                                                </div>
                                            </div>
                                            <div class="flex-grow-1 ms-3">
                                                <div class="d-flex justify-content-between align-items-center mb-1">
                                                    <h6 class="mb-0">Sarah Jones</h6>
                                                    <div class="text-warning small">
                                                        <i class="bi bi-star-fill"></i>
                                                        <i class="bi bi-star-fill"></i>
                                                        <i class="bi bi-star-fill"></i>
                                                        <i class="bi bi-star-fill"></i>
                                                        <i class="bi bi-star"></i>
                                                    </div>
                                                </div>
                                                <p class="text-muted small mb-0">1 month ago</p>
                                                <p class="mt-2">Very professional and knowledgeable. Would recommend!</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="border-top pt-3 mt-3 d-flex justify-content-between">
                            <a class="btn btn-outline-primary" asp-controller="Orders" asp-action="MyAcceptedOrders">
                                <i class="bi bi-clipboard-check me-1"></i> View My Orders
                            </a>
                            <a class="btn btn-primary" asp-controller="Orders" asp-action="PendingOrders">
                                <i class="bi bi-search me-1"></i> Find New Jobs
                            </a>
                        </div>
                    }
                    else
                    {
                        <!-- Client Activity -->
                        <ul class="nav nav-pills mb-3" id="clientTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="active-tab" data-bs-toggle="pill" data-bs-target="#active" type="button" role="tab" aria-controls="active" aria-selected="true">
                                    <i class="bi bi-clock-history me-1"></i>Recent Activity
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="stats-tab" data-bs-toggle="pill" data-bs-target="#stats" type="button" role="tab" aria-controls="stats" aria-selected="false">
                                    <i class="bi bi-graph-up me-1"></i>Statistics
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="preferences-tab" data-bs-toggle="pill" data-bs-target="#preferences" type="button" role="tab" aria-controls="preferences" aria-selected="false">
                                    <i class="bi bi-sliders me-1"></i>Preferences
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="clientTabContent">                            <!-- Recent Activity Tab -->
                            <div class="tab-pane fade show active" id="active" role="tabpanel" aria-labelledby="active-tab">
                                @if (ViewBag.RecentOrders != null && ((List<ClientOrder>)ViewBag.RecentOrders).Count > 0)
                                {
                                    <div class="list-group shadow-sm">
                                        @foreach (var order in (List<ClientOrder>)ViewBag.RecentOrders)
                                        {
                                            <div class="list-group-item list-group-item-action p-3">
                                                <div class="d-flex align-items-center justify-content-between">
                                                    <div>
                                                        <h6 class="mb-1 fw-bold">@order.ServiceType</h6>
                                                        <p class="mb-0 text-muted small">Scheduled: @(order.ScheduledTime?.ToString("MMM dd, yyyy - h:mm tt") ?? "Flexible")</p>
                                                        <div class="mt-2">
                                                            <span class="badge bg-@(order.Status == OrderStatus.Pending ? "warning text-dark" : 
                                                                        order.Status == OrderStatus.Accepted ? "info" : 
                                                                        order.Status == OrderStatus.Completed ? "success" :
                                                                        order.Status == OrderStatus.Declined ? "danger" : "secondary")">
                                                                @order.Status
                                                            </span>
                                                            @if (!string.IsNullOrEmpty(order.Location))
                                                            {
                                                                <span class="badge bg-secondary">@order.Location</span>
                                                            }
                                                        </div>
                                                    </div>
                                                    <div class="text-center">
                                                        <div class="text-muted small mb-1">@((DateTime.Now - order.OrderDate).Days) days ago</div>
                                                        <a asp-controller="Orders" asp-action="Details" asp-route-id="@order.Id" class="btn btn-sm btn-outline-primary">View</a>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="text-center py-4">
                                        <i class="bi bi-clipboard-x text-muted" style="font-size: 2rem;"></i>
                                        <p class="mt-3 text-muted">No recent activity</p>
                                        <a asp-controller="Orders" asp-action="CreateOrder" class="btn btn-primary mt-2">
                                            <i class="bi bi-plus-circle me-1"></i> Create Your First Order
                                        </a>
                                    </div>
                                }
                            </div>
                              <!-- Statistics Tab -->
                            <div class="tab-pane fade" id="stats" role="tabpanel" aria-labelledby="stats-tab">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="card border h-100">
                                            <div class="card-body text-center">
                                                <h6 class="text-muted mb-3">Service Summary</h6>
                                                <div style="height: 200px; position: relative;">
                                                    <div class="position-absolute top-50 start-50 translate-middle">
                                                        <div class="text-center">
                                                            <div class="rounded-circle border border-3 border-primary d-inline-flex justify-content-center align-items-center" style="width: 150px; height: 150px;">
                                                                <div>
                                                                    <div class="text-primary mb-1">
                                                                        <i class="bi bi-clipboard-check" style="font-size: 2rem;"></i>
                                                                    </div>
                                                                    <div class="small">
                                                                        <div class="fw-bold">Total Orders: @(ViewBag.OrdersCount ?? 0)</div>
                                                                        @if (ViewBag.RecentOrders != null)
                                                                        {
                                                                            var recentOrders = (List<ClientOrder>)ViewBag.RecentOrders;
                                                                            var pendingCount = recentOrders.Count(o => o.Status == OrderStatus.Pending);
                                                                            var completedCount = recentOrders.Count(o => o.Status == OrderStatus.Completed);
                                                                            <div>Pending: @pendingCount</div>
                                                                            <div>Completed: @completedCount</div>
                                                                        }
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card border h-100">
                                            <div class="card-body text-center">
                                                <h6 class="text-muted mb-3">Service History</h6>
                                                <div style="height: 200px; position: relative;">
                                                    <div class="position-absolute top-50 start-50 translate-middle w-100">
                                                        @if (ViewBag.RecentOrders != null && ((List<ClientOrder>)ViewBag.RecentOrders).Count > 0)
                                                        {
                                                            var recentOrders = (List<ClientOrder>)ViewBag.RecentOrders;
                                                            var currentYear = DateTime.Now.Year;
                                                            var thisYearOrders = recentOrders.Count(o => o.OrderDate.Year == currentYear);
                                                            var lastYearOrders = recentOrders.Count(o => o.OrderDate.Year == currentYear - 1);
                                                            var maxOrders = Math.Max(thisYearOrders, Math.Max(lastYearOrders, 1));
                                                            
                                                            <div class="mb-3">
                                                                <div class="d-flex justify-content-between mb-1 small">
                                                                    <span>@currentYear</span>
                                                                    <span>@thisYearOrders services</span>
                                                                </div>
                                                                <div class="progress" style="height: 8px;">
                                                                    <div class="progress-bar bg-primary" role="progressbar" style="width: @((thisYearOrders * 100.0 / maxOrders).ToString("0"))%" aria-valuenow="@thisYearOrders" aria-valuemin="0" aria-valuemax="@maxOrders"></div>
                                                                </div>
                                                            </div>
                                                            <div class="mb-3">
                                                                <div class="d-flex justify-content-between mb-1 small">
                                                                    <span>@(currentYear - 1)</span>
                                                                    <span>@lastYearOrders services</span>
                                                                </div>
                                                                <div class="progress" style="height: 8px;">
                                                                    <div class="progress-bar bg-info" role="progressbar" style="width: @((lastYearOrders * 100.0 / maxOrders).ToString("0"))%" aria-valuenow="@lastYearOrders" aria-valuemin="0" aria-valuemax="@maxOrders"></div>
                                                                </div>
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <div class="text-center">
                                                                <i class="bi bi-bar-chart text-muted" style="font-size: 2rem;"></i>
                                                                <p class="mt-2 text-muted">No service history available</p>
                                                            </div>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Preferences Tab -->
                            <div class="tab-pane fade" id="preferences" role="tabpanel" aria-labelledby="preferences-tab">
                                <form>
                                    <div class="mb-3">
                                        <label class="form-label fw-medium">Communication Preferences</label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="emailNotifs" checked>
                                            <label class="form-check-label" for="emailNotifs">Email Notifications</label>
                                        </div>
                                        <div class="form-check form-switch mt-2">
                                            <input class="form-check-input" type="checkbox" id="smsNotifs">
                                            <label class="form-check-label" for="smsNotifs">SMS Notifications</label>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-medium">Preferred Service Type</label>
                                        <select class="form-select">
                                            <option selected>No preference</option>
                                            <option>Oil Change</option>
                                            <option>Engine Repair</option>
                                            <option>Brake Service</option>
                                            <option>Transmission</option>
                                            <option>Electrical Repair</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-medium">Preferred Location</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" placeholder="Enter location" value="Downtown Area">
                                            <button class="btn btn-outline-secondary" type="button">
                                                <i class="bi bi-geo-alt"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-save me-1"></i> Save Preferences
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="border-top pt-3 mt-3">
                            <div class="d-flex justify-content-between">
                                <a class="btn btn-outline-primary" asp-controller="Orders" asp-action="MyOrders">
                                    <i class="bi bi-list me-1"></i> View All Orders
                                </a>
                                <a class="btn btn-primary" asp-controller="Orders" asp-action="CreateOrder">
                                    <i class="bi bi-plus-circle me-1"></i> Request New Service
                                </a>
                            </div>
                        </div>
                    }
                </div>
            </div>
            
            <!-- Additional Dashboard Widget -->
            <div class="card shadow-sm mb-4 rounded-3 border-0 mt-4">
                <div class="card-header bg-white border-bottom-0">
                    <h5 class="text-primary mb-0">
                        <i class="bi bi-speedometer2 me-2"></i>Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <a href="#" class="text-decoration-none">
                                <div class="card bg-light h-100 border-0">
                                    <div class="card-body text-center py-4">
                                        <div class="rounded-circle bg-primary mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                            <i class="bi bi-calendar2-plus text-white fs-4"></i>
                                        </div>
                                        <h6 class="fw-bold">Schedule Service</h6>
                                        <p class="text-muted small mb-0">Book a new appointment</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a href="#" class="text-decoration-none">
                                <div class="card bg-light h-100 border-0">
                                    <div class="card-body text-center py-4">
                                        <div class="rounded-circle bg-warning mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                            <i class="bi bi-chat-dots text-white fs-4"></i>
                                        </div>
                                        <h6 class="fw-bold">Contact Support</h6>
                                        <p class="text-muted small mb-0">Get help with issues</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a href="#" class="text-decoration-none">
                                <div class="card bg-light h-100 border-0">
                                    <div class="card-body text-center py-4">
                                        <div class="rounded-circle bg-success mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                            <i class="bi bi-file-earmark-text text-white fs-4"></i>
                                        </div>
                                        <h6 class="fw-bold">Service History</h6>
                                        <p class="text-muted small mb-0">View past services</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Initialize Bootstrap Tooltips -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        
        // Animate stats on scroll
        const animateStats = () => {
            const statsElements = document.querySelectorAll('.fw-bold');
            statsElements.forEach(stat => {
                const value = parseFloat(stat.innerText);
                if (!isNaN(value) && !stat.classList.contains('animated')) {
                    const duration = 1500;
                    const step = value / duration * 10;
                    let current = 0;
                    stat.classList.add('animated');
                    
                    const animate = () => {
                        current += step;
                        if (current <= value) {
                            if (Number.isInteger(value)) {
                                stat.innerText = Math.floor(current);
                            } else {
                                stat.innerText = current.toFixed(1);
                            }
                            setTimeout(animate, 10);
                        } else {
                            stat.innerText = value;
                        }
                    };
                    
                    animate();
                }
            });
        };
        
        // Simple intersection observer to trigger animations when elements come into view
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    animateStats();
                }
            });
        });
        
        // Observe the stats section
        const statsSection = document.querySelector('.row.text-center');
        if (statsSection) {
            observer.observe(statsSection);
        }
    });
</script>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="editProfileModalLabel"><i class="bi bi-person-gear me-2"></i>Edit Profile Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form asp-controller="Account" asp-action="UpdateProfile" asp-route-id="@userId" method="post" enctype="multipart/form-data" id="profileEditForm">
                    <div class="row g-3">
                        <!-- Profile Image Upload -->
                        <div class="col-12 mb-3 text-center">
                            <div class="position-relative mx-auto mb-3" style="width: 120px; height: 120px;">
                                <div class="rounded-circle bg-light border d-flex align-items-center justify-content-center overflow-hidden" style="width: 120px; height: 120px;">
                                    <i class="bi bi-person-circle text-primary" style="font-size: 5rem;"></i>
                                </div>
                                <label for="profileImage" class="position-absolute bottom-0 end-0 bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 34px; height: 34px; cursor: pointer;">
                                    <i class="bi bi-camera"></i>
                                </label>
                                <input type="file" id="profileImage" name="ProfileImage" class="d-none" accept="image/*">
                            </div>
                            <p class="small text-muted">Click the camera icon to change your profile picture</p>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-medium">Full Name</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-person"></i></span>
                                <input type="text" class="form-control" id="fullName" name="FullName" value="@fullName" required>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-medium">Username</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-at"></i></span>
                                <input type="text" class="form-control" id="userName" name="UserName" value="@userName" required>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-medium">Email Address</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                                <input type="email" class="form-control" id="email" name="Email" value="@email" required>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-medium">Phone Number</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-phone"></i></span>
                                <input type="tel" class="form-control" id="phoneNumber" name="PhoneNumber" placeholder="Enter phone number">
                            </div>
                        </div>

                        <div class="col-12 mb-3">
                            <label class="form-label fw-medium">Address</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-geo-alt"></i></span>
                                <input type="text" class="form-control" id="address" name="Address" placeholder="Enter your address">
                            </div>
                        </div>

                        @if (isMechanic)
                        {
                            <div class="col-12 mb-3">
                                <label class="form-label fw-medium">Bio</label>
                                <textarea class="form-control" id="bio" name="Bio" rows="3" placeholder="Tell clients about yourself and your expertise"></textarea>
                            </div>

                            <div class="col-12 mb-3">
                                <label class="form-label fw-medium">Skills</label>
                                <div class="input-group mb-2">
                                    <span class="input-group-text"><i class="bi bi-tools"></i></span>
                                    <input type="text" class="form-control" id="newSkill" placeholder="Add a new skill">
                                    <button type="button" class="btn btn-primary" id="addSkillBtn"><i class="bi bi-plus-lg"></i></button>
                                </div>
                                <div class="d-flex flex-wrap gap-2 mt-2" id="skillsContainer">
                                    <!-- Skills will be added here dynamically -->
                                </div>
                                <div id="skillsInputs">
                                    <!-- Hidden inputs for skills will be added here -->
                                </div>
                            </div>

                            <div class="col-12">
                                <label class="form-label fw-medium">Services Offered</label>
                                <div class="row g-2 mb-2">
                                    <div class="col-md-5">
                                        <input type="text" class="form-control" id="newServiceName" placeholder="Service name">
                                    </div>
                                    <div class="col-md-5">
                                        <input type="text" class="form-control" id="newServicePrice" placeholder="Price (e.g. $50)">
                                    </div>
                                    <div class="col-md-2">
                                        <button type="button" class="btn btn-primary w-100" id="addServiceBtn"><i class="bi bi-plus-lg"></i></button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover" id="servicesTable">
                                        <thead>
                                            <tr>
                                                <th>Service</th>
                                                <th>Price</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Services will be added here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                                <div id="servicesInputs">
                                    <!-- Hidden inputs for services will be added here -->
                                </div>
                            </div>
                        }
                      </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal"><i class="bi bi-x-lg me-1"></i>Cancel</button>
                <button type="submit" form="profileEditForm" class="btn btn-primary"><i class="bi bi-save me-1"></i>Save Changes</button>
            </div>
        </div>
    </div>
</div>

<!-- Skills & Services JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle skills
        const addSkillBtn = document.getElementById('addSkillBtn');
        const newSkillInput = document.getElementById('newSkill');
        const skillsContainer = document.getElementById('skillsContainer');
        const skillsInputs = document.getElementById('skillsInputs');
        
        // Sample initial skills - replace with actual skills from the model
        const initialSkills = ['Engine Repair', 'Transmission', 'Brakes', 'Electrical Systems', 'Suspension', 'A/C Repair'];
        
        // Add initial skills
        initialSkills.forEach(skill => {
            addSkillTag(skill);
        });
        
        if (addSkillBtn) {
            addSkillBtn.addEventListener('click', function() {
                const skillText = newSkillInput.value.trim();
                if (skillText) {
                    addSkillTag(skillText);
                    newSkillInput.value = '';
                    newSkillInput.focus();
                }
            });
        }
        
        function addSkillTag(skill) {
            // Create visible tag
            const tag = document.createElement('span');
            tag.className = 'badge bg-primary py-2 px-3 d-flex align-items-center';
            tag.innerHTML = `
                <span>${skill}</span>
                <button type="button" class="btn-close btn-close-white ms-2" aria-label="Remove" style="font-size: 0.5rem;"></button>
            `;
            skillsContainer.appendChild(tag);
            
            // Create hidden input
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'Skills';
            input.value = skill;
            skillsInputs.appendChild(input);
            
            // Add remove event
            tag.querySelector('.btn-close').addEventListener('click', function() {
                tag.remove();
                input.remove();
            });
        }
        
        // Handle services
        const addServiceBtn = document.getElementById('addServiceBtn');
        const newServiceNameInput = document.getElementById('newServiceName');
        const newServicePriceInput = document.getElementById('newServicePrice');
        const servicesTable = document.getElementById('servicesTable');
        const servicesTableBody = servicesTable ? servicesTable.querySelector('tbody') : null;
        const servicesInputs = document.getElementById('servicesInputs');
        
        // Sample initial services - replace with actual services from the model
        const initialServices = [
            { name: 'Oil Change', price: '$29.99' },
            { name: 'Brake Service', price: '$89.99' },
            { name: 'Battery Replacement', price: '$75.99' },
            { name: 'Tire Rotation', price: '$49.99' }
        ];
        
        // Add initial services
        initialServices.forEach(service => {
            addServiceRow(service.name, service.price);
        });
        
        if (addServiceBtn) {
            addServiceBtn.addEventListener('click', function() {
                const serviceName = newServiceNameInput.value.trim();
                const servicePrice = newServicePriceInput.value.trim();
                
                if (serviceName && servicePrice) {
                    addServiceRow(serviceName, servicePrice);
                    newServiceNameInput.value = '';
                    newServicePriceInput.value = '';
                    newServiceNameInput.focus();
                }
            });
        }
        
        function addServiceRow(name, price) {
            if (!servicesTableBody) return;
            
            // Create table row
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${name}</td>
                <td>${price}</td>
                <td>
                    <button type="button" class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-trash"></i>
                    </button>
                </td>
            `;
            servicesTableBody.appendChild(row);
            
            // Create hidden inputs
            const nameInput = document.createElement('input');
            nameInput.type = 'hidden';
            nameInput.name = 'Services';
            nameInput.value = name;
            
            const priceInput = document.createElement('input');
            priceInput.type = 'hidden';
            priceInput.name = 'ServicePrices';
            priceInput.value = price;
            
            servicesInputs.appendChild(nameInput);
            servicesInputs.appendChild(priceInput);
            
            // Add remove event
            row.querySelector('.btn-outline-danger').addEventListener('click', function() {
                row.remove();
                nameInput.remove();
                priceInput.remove();
            });
        }
    });
</script>

<!-- Additional CSS for theme and accessibility -->
<style>
    /* Dark Mode */
    html.dark-mode {
        --bs-body-bg: #121212;
        --bs-body-color: #e0e0e0;
        --bs-card-bg: #1e1e1e;
        --bs-card-border-color: #333;
        --bs-border-color: #333;
    }
    
    html.dark-mode .card {
        background-color: #1e1e1e;
        border-color: #333;
    }
    
    html.dark-mode .bg-white {
        background-color: #1e1e1e !important;
    }
    
    html.dark-mode .bg-light {
        background-color: #2c2c2c !important;
    }
    
    html.dark-mode .text-dark {
        color: #e0e0e0 !important;
    }
    
    html.dark-mode .text-muted {
        color: #adb5bd !important;
    }
    
    /* High Contrast Mode */
    .high-contrast {
        --bs-primary: #0066ff;
        --bs-success: #00cc66;
        --bs-danger: #ff0000;
        --bs-warning: #ffcc00;
        --bs-info: #00ccff;
    }
    
    .high-contrast .text-muted {
        color: #000000 !important;
    }
    
    html.dark-mode .high-contrast .text-muted {
        color: #ffffff !important;
    }
    
    .high-contrast .card {
        border-width: 2px !important;
    }
    
    /* Font Sizes */
    .font-small {
        font-size: 0.9rem;
    }
    
    .font-medium {
        font-size: 1rem;
    }
    
    .font-large {
        font-size: 1.2rem;
    }
    
    .font-large h1, .font-large h2, .font-large h3, 
    .font-large h4, .font-large h5, .font-large h6 {
        margin-top: 1.2em;
        margin-bottom: 0.8em;
    }
</style>

<!-- Custom CSS for profile page -->
<style>
    /* Animated Progress Bars with Gradient */
    .progress-bar {
        transition: width 1.5s ease-in-out;
        background-image: linear-gradient(45deg, rgba(255,255,255,.15) 25%, transparent 25%, transparent 50%, rgba(255,255,255,.15) 50%, rgba(255,255,255,.15) 75%, transparent 75%, transparent);
        background-size: 1rem 1rem;
        animation: progress-bar-stripes 1s linear infinite;
    }
    
    .bg-success {
        background-image: linear-gradient(to right, #28a745, #20c997);
    }
    
    .bg-primary {
        background-image: linear-gradient(to right, #007bff, #6610f2);
    }
    
    .bg-warning {
        background-image: linear-gradient(to right, #ffc107, #fd7e14);
    }
    
    .bg-info {
        background-image: linear-gradient(to right, #17a2b8, #20c997);
    }
    
    /* Profile Card Hover Effects */
    .card {
        transition: all 0.3s ease-in-out;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
    }
    
    /* Avatar Pulse Effect */
    .avatar-profile {
        position: relative;
    }
    
    .avatar-profile::after {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        border-radius: 50%;
        border: 3px solid rgba(255,255,255,0.6);
        animation: pulse 2s infinite;
        box-sizing: border-box;
    }
      @@keyframes pulse {
        0% {
            transform: scale(1);
            opacity: 1;
        }
        50% {
            transform: scale(1.05);
            opacity: 0.8;
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }
    
    /* Quick Action Cards Animation */
    .col-md-4 a .card {
        transition: all 0.3s ease;
    }
    
    .col-md-4 a .card:hover {
        transform: translateY(-10px);
    }
    
    .col-md-4 a .card:hover .rounded-circle {
        transform: scale(1.1);
    }
    
    .rounded-circle {
        transition: all 0.3s ease;
    }
    
    /* Tab Animation */
    .tab-pane.fade {
        transition: opacity 0.5s linear;
    }
    
    /* Alert Animation */
    .alert-success {
        animation: slideDown 0.5s forwards;
    }
      @@keyframes slideDown {
        from {
            transform: translateY(-20px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
</style>
